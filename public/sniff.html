<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>R.I.P.</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

</head>

<style>
  #rain {
    pointer-events: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('https://media1.tenor.com/m/vFCzEyJEVrwAAAAC/rain-rain-drops.gif');
    background-size: cover;
    opacity: 0.5;
    z-index: -1;
  }

  #rat {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
  }

  #rat img {
    max-width: 300px;
    /* limit width */
    max-height: 300px;
    /* limit height */
    width: 100%;
    /* responsive downscaling */
    height: auto;
    border-radius: 8px;
  }

  button {
    margin-top: 1rem;
    background: #555;
    color: white;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
  }

  button:hover {
    background: #777;
  }

  .custom-window-controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    display: flex;
    gap: 10px;
    z-index: 9999;
  }

  .custom-window-controls button {
    background: #333;
    color: white;
    border: none;
    border-radius: 6px;
    width: 32px;
    height: 32px;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .custom-window-controls button:hover {
    background: #555;
  }
</style>

<body class="container mt-4">
  <nav class="navbar fixed-top navbar-dark navbar-expand  bg-dark">
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a class="nav-item nav-link" href="">Sniff SniffðŸ˜¢</a></li>
        <li><a class="nav-item nav-link" href="stats.html">Statistics</a></li>
      </ul>
    </div>
    </div>
  </nav>

  <br>
  <br>

  <div id="content">
    <div id="rain"></div>
    <h3>Let's take a moment of silence for all of our brothers who have fallen by the hand of YOU, security learner.
    </h3>
    <div id="rat"><img src="https://media1.tenor.com/m/6h3wxIv5cukAAAAd/super-sentai-hurricaneger.gif"></div>
    <ul id="encryptedList" class="list-group" style="margin-bottom: 4rem;"></ul>
  </div>

  <audio autoplay loop>
    <source src="guts.wav" type="audio/mpeg">
  </audio>

  <script type="module">
    // Load and display the list from localStorage
    const listContainer = document.getElementById('encryptedList');
    const stored = localStorage.getItem('encryptedFiles');

    if (stored) {
      try {
        const files = JSON.parse(stored);

        if (Array.isArray(files) && files.length > 0) {
          files.forEach(async fileName => {
            const li = document.createElement('li');
            li.className = 'list-group-item';

            const nameElem = document.createElement('h6');
            nameElem.textContent = fileName;
            nameElem.style.fontWeight = 'bold';
            li.appendChild(nameElem);

            try {
              const text = atob(localStorage.getItem('partial_' + fileName));

              const contentElem = document.createElement('pre');
              contentElem.textContent = text;
              contentElem.style.whiteSpace = 'pre-wrap';
              contentElem.style.marginTop = '0.5em';
              li.appendChild(contentElem);

            } catch (err) {
              const errorElem = document.createElement('span');
              errorElem.textContent = `Error loading ${fileName}: ${err.message}`;
              errorElem.style.color = 'red';
              li.appendChild(errorElem);
            }

            listContainer.appendChild(li);
          });
        } else {
          listContainer.innerHTML = '<li class="list-group-item text-muted">No files found</li>';
        }
      } catch (e) {
        listContainer.innerHTML = '<li class="list-group-item text-danger">Invalid storage format</li>';
      }
    } else {
      listContainer.innerHTML = '<li class="list-group-item text-muted">No files saved yet</li>';
    }
    document.getElementById('minimize')?.addEventListener('click', () => {
      window.electronAPI.minimize();
    });

    document.getElementById('maximize')?.addEventListener('click', () => {
      window.electronAPI.maximize();
    });

    document.getElementById('close')?.addEventListener('click', () => {
      window.electronAPI.close();
    });
  </script>
  <div class="custom-window-controls">
    <button id="minimize">â€“</button> <!-- TODO: REMOVE IN PRODUCTION ðŸ¤¡ðŸ¤¡ðŸ¤¡ -->
    <!-- <button id="maximize">â–¡</button> -->
    <button id="close">Ã—</button>
  </div>
</body>